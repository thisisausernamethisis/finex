# Patch 3: Enhanced UI Components

## Overview
Adds missing Shadcn UI components and common UI patterns needed for the modernized frontend. This patch prepares the UI foundation for advanced features like accordion boards and modal dialogs.

## Dependencies
- Patch 1 (React Query Setup)

## Estimated Effort
2-3 hours

## Risk Level
Low

---

## Changes Required

### 1. Add Missing Shadcn Components

**Install Required Components**:
```bash
npx shadcn@latest add accordion alert-dialog skeleton
```

### 2. Accordion Component (Critical for Asset Board)

**File**: `components/ui/accordion.tsx` (auto-generated by shadcn)
```tsx
// This will be generated by the shadcn command above
// Used for Theme → Card hierarchy in asset board
```

### 3. Alert Dialog Component (For Confirmations)

**File**: `components/ui/alert-dialog.tsx` (auto-generated by shadcn)  
```tsx
// This will be generated by the shadcn command above
// Used for delete confirmations and important actions
```

### 4. Skeleton Component (For Loading States)

**File**: `components/ui/skeleton.tsx` (auto-generated by shadcn)
```tsx
// This will be generated by the shadcn command above  
// Used for better loading experiences with React Query
```

### 5. Common Loading Components

**File**: `components/common/LoadingSpinner.tsx` (new file)
```tsx
import { Loader2 } from 'lucide-react';
import { cn } from '@/lib/utils';

interface LoadingSpinnerProps {
  className?: string;
  size?: 'sm' | 'md' | 'lg';
}

export function LoadingSpinner({ className, size = 'md' }: LoadingSpinnerProps) {
  const sizeClasses = {
    sm: 'w-4 h-4',
    md: 'w-6 h-6', 
    lg: 'w-8 h-8'
  };

  return (
    <Loader2 
      className={cn('animate-spin', sizeClasses[size], className)} 
    />
  );
}
```

**File**: `components/common/LoadingCard.tsx` (new file)
```tsx
import { Card } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton';

export function LoadingCard() {
  return (
    <Card className="p-6">
      <div className="space-y-3">
        <Skeleton className="h-4 w-3/4" />
        <Skeleton className="h-4 w-1/2" />
        <Skeleton className="h-20 w-full" />
        <div className="flex space-x-2">
          <Skeleton className="h-8 w-16" />
          <Skeleton className="h-8 w-16" />
        </div>
      </div>
    </Card>
  );
}
```

### 6. Error Boundary Component

**File**: `components/common/ErrorBoundary.tsx` (new file)
```tsx
'use client';

import React from 'react';
import { AlertTriangle } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';

interface ErrorBoundaryState {
  hasError: boolean;
  error?: Error;
}

interface ErrorBoundaryProps {
  children: React.ReactNode;
  fallback?: React.ReactNode;
}

export class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {
  constructor(props: ErrorBoundaryProps) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('ErrorBoundary caught an error:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }

      return (
        <Card className="p-6 m-4">
          <div className="flex items-center space-x-3 text-destructive mb-4">
            <AlertTriangle className="w-5 h-5" />
            <h3 className="font-semibold">Something went wrong</h3>
          </div>
          <p className="text-muted-foreground mb-4">
            An error occurred while rendering this component. Please try refreshing the page.
          </p>
          <Button 
            onClick={() => window.location.reload()}
            variant="outline"
          >
            Refresh Page
          </Button>
        </Card>
      );
    }

    return this.props.children;
  }
}
```

### 7. Enhanced Form Components

**File**: `components/common/FormField.tsx` (new file)
```tsx
import { Label } from '@/components/ui/label';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { cn } from '@/lib/utils';

interface FormFieldProps {
  label: string;
  name: string;
  type?: 'text' | 'email' | 'password' | 'textarea';
  placeholder?: string;
  value: string;
  onChange: (value: string) => void;
  error?: string;
  required?: boolean;
  className?: string;
}

export function FormField({
  label,
  name,
  type = 'text',
  placeholder,
  value,
  onChange,
  error,
  required,
  className
}: FormFieldProps) {
  const InputComponent = type === 'textarea' ? Textarea : Input;

  return (
    <div className={cn('space-y-2', className)}>
      <Label htmlFor={name}>
        {label}
        {required && <span className="text-destructive ml-1">*</span>}
      </Label>
      <InputComponent
        id={name}
        name={name}
        type={type === 'textarea' ? undefined : type}
        placeholder={placeholder}
        value={value}
        onChange={(e) => onChange(e.target.value)}
        className={cn(error && 'border-destructive')}
      />
      {error && (
        <p className="text-sm text-destructive">{error}</p>
      )}
    </div>
  );
}
```

### 8. Query State Components  

**File**: `components/common/QueryStateHandler.tsx` (new file)
```tsx
import { LoadingSpinner } from './LoadingSpinner';
import { ErrorBoundary } from './ErrorBoundary';
import { AlertTriangle, RefreshCw } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';

interface QueryStateHandlerProps {
  isLoading: boolean;
  error: Error | null;
  children: React.ReactNode;
  onRetry?: () => void;
  loadingComponent?: React.ReactNode;
}

export function QueryStateHandler({
  isLoading,
  error,
  children,
  onRetry,
  loadingComponent
}: QueryStateHandlerProps) {
  if (isLoading) {
    return loadingComponent || (
      <div className="flex items-center justify-center p-8">
        <LoadingSpinner size="lg" />
      </div>
    );
  }

  if (error) {
    return (
      <Card className="p-6 m-4">
        <div className="flex items-center space-x-3 text-destructive mb-4">
          <AlertTriangle className="w-5 h-5" />
          <h3 className="font-semibold">Error Loading Data</h3>
        </div>
        <p className="text-muted-foreground mb-4">
          {error.message || 'An unexpected error occurred while loading data.'}
        </p>
        {onRetry && (
          <Button onClick={onRetry} variant="outline" size="sm">
            <RefreshCw className="w-4 h-4 mr-2" />
            Try Again
          </Button>
        )}
      </Card>
    );
  }

  return <ErrorBoundary>{children}</ErrorBoundary>;
}
```

---

## Verification & Testing

### Manual Testing
1. **Component Installation**: Verify all shadcn components install without errors
2. **Import Testing**: Ensure all new components can be imported
3. **Rendering**: Test each component renders correctly in isolation
4. **Styling**: Verify components follow design system patterns

### Integration Testing
```tsx
// Example usage in a component
import { QueryStateHandler } from '@/components/common/QueryStateHandler';
import { useAssets } from '@/hooks/useAssets';

function AssetsExample() {
  const { data, isLoading, error, refetch } = useAssets();

  return (
    <QueryStateHandler 
      isLoading={isLoading}
      error={error}
      onRetry={refetch}
    >
      {/* Component content when loaded successfully */}
      <div>{data?.items.length} assets loaded</div>
    </QueryStateHandler>
  );
}
```

### Verification Checklist
- [ ] Accordion component available for asset board
- [ ] Alert dialog works for confirmations
- [ ] Skeleton components improve loading UX
- [ ] ErrorBoundary catches and displays errors gracefully
- [ ] LoadingSpinner shows appropriate loading states
- [ ] FormField provides consistent form styling
- [ ] QueryStateHandler integrates with React Query patterns

---

## Usage Examples

### Accordion for Asset Board
```tsx
import { 
  Accordion, 
  AccordionContent, 
  AccordionItem, 
  AccordionTrigger 
} from '@/components/ui/accordion';

// Used in asset board for Theme → Card hierarchy
<Accordion type="multiple">
  <AccordionItem value="theme-1">
    <AccordionTrigger>Theme Name</AccordionTrigger>
    <AccordionContent>
      {/* Cards for this theme */}
    </AccordionContent>
  </AccordionItem>
</Accordion>
```

### Alert Dialog for Confirmations
```tsx
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from '@/components/ui/alert-dialog';

// Used for delete confirmations
<AlertDialog>
  <AlertDialogTrigger asChild>
    <Button variant="destructive">Delete Asset</Button>
  </AlertDialogTrigger>
  <AlertDialogContent>
    <AlertDialogHeader>
      <AlertDialogTitle>Are you sure?</AlertDialogTitle>
      <AlertDialogDescription>
        This action cannot be undone. This will permanently delete the asset.
      </AlertDialogDescription>
    </AlertDialogHeader>
    <AlertDialogFooter>
      <AlertDialogCancel>Cancel</AlertDialogCancel>
      <AlertDialogAction onClick={handleDelete}>Delete</AlertDialogAction>
    </AlertDialogFooter>
  </AlertDialogContent>
</AlertDialog>
```

---

## Success Criteria

### Before
- Limited UI components
- No standardized loading states  
- No error boundaries
- Inconsistent form patterns

### After  
- Complete UI component library ready for asset board
- Standardized loading and error states
- Consistent form field patterns
- Error boundaries prevent app crashes
- React Query integration patterns established

---

## Rollback Plan
If issues arise:
1. Remove newly added components from `components/ui/` and `components/common/`
2. Uninstall shadcn components if needed
3. Existing components continue to work normally
4. No breaking changes to current functionality

---

## Notes
- Shadcn components come with proper TypeScript definitions
- All components follow existing design system patterns
- LoadingSpinner and QueryStateHandler are designed for React Query integration
- ErrorBoundary provides graceful degradation
- Components are ready for use in subsequent patches, especially asset board implementation
``` 